<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
        <title>社交关系分析</title>
        
        <link href="css/graph.css" rel="stylesheet"/>
        <link href="../js/colpick/colpick.css" rel="stylesheet"/>
    </head>

    <body>
    	<div id="container">
		    <div class="left">
		    	<div class="toolbar blue">布局算法</div>
		    	<div>
		    		<div class="btn-group">
		    			<div class="input-group">
		    				<select id="layout-type">
									<option value="kk">kaiwai layout</option>
									<option value="fr">fr layout</option>
									<option value="fruchterman">fruchterman layout</option>
									<option value="spring">spring layout</option>
									<option value="spring2">spring2 layout</option>
									<option value="arf">arf layout</option>
									<option value="singleCirlce">single circle layout</option>
									<option value="dualCirlce">double circle layout</option>
									<option value="layerCircle">layer circle layout</option>
									<option value="grid">grid layout</option>
									<option value="tree">tree layout</option>
									<option value="radiatree">radiatree layout</option>
									<option value="balloontree">balloontree layout</option>
									<option value="balloon">balloon layout</option>
							</select>
		    			</div>
		    			<div id="runbtn" class="btn btn-default btn-sm">运行</div>
		    		</div>
		    		<div class="wrapper-title">【<label id="cur-node">节点</label>】最近邻集</div>
		    		<div id="neighber-nodes" class="node-wrapper"></div>
	    		
		    	</div>
		    </div>
		    <div class="right">
		    	<div class="toolbar blue">图属性信息</div>
		    	<div class="params-wrap">
		    		<div class="parmas-info"><label for="nodecount">点：</label><span id="nodecount">0</span></div>
		    		<div class="parmas-info"><label for="linkcount">边：</label><span id="linkcount">0</span></div>
		    		<div class="parmas-info"><label for="nodesize">点大小：</label><input id="nodesize" type="range" min="5" max="30" step="1" value="10"/></div>
		    		<div class="parmas-info"><label for="nodealpha">透明度：</label><input id="nodealpha" type="range" min="0.1" max="1" step="0.1" value="0.8"/></div>
		    		<div class="parmas-info"><label for="nodeColor">点颜色：</label><span class="colorpick" id="nodeColor">&emsp;&emsp;&emsp;&emsp;</span></div>
		    		<div class="parmas-info"><label for="linkColor">边颜色：</label><span class="colorpick" id="linkColor">&emsp;&emsp;&emsp;&emsp;</span></div>
		    	</div>
		    </div>
		    <div class="center">
		    	<div class="toolbar blue">
		    		<div id="mousetype" class="btn-group">
		    			<div class="btn btn-default btn-sm active" type="normal" title="默认模式">
		    				<div class="q-icon toolbar-default"></div>
		    			</div>
		    			<div class="btn btn-default btn-sm" type="select" title="框选模式">
		    				<div class="q-icon toolbar-rectangle_selection"></div>
		    			</div>
		    			<div class="btn btn-default btn-sm" type="drag" title="浏览模式">
		    				<div class="q-icon toolbar-pan"></div>
		    			</div>
		    		</div>
		    		<div id="zoomtype" class="btn-group">
		    			<div class="btn btn-default btn-sm" type="zoomOut"  title="放大"><div class="q-icon toolbar-zoomin"></div></div>
		    			<div class="btn btn-default btn-sm" type="zoomIn" title="缩小"><div class="q-icon toolbar-zoomout"></div></div>
		    			<div class="btn btn-default btn-sm" type="zoom1" title="1:1"><div class="q-icon toolbar-zoomreset"></div></div>
		    			<div class="btn btn-default btn-sm" type="zoom11" title="纵览"><div class="q-icon toolbar-zoom_overview"></div></div>
		    		</div>
		    		<div class="btn-group">
		    			<div id="overview" flag="false" class="btn btn-default btn-sm" title="缩略图"><div class="q-icon toolbar-overview"></div></div>
		    			<div id="savepic" class="btn btn-default btn-sm" title="保存图片"><div class="q-icon toolbar-print"></div></div>
		    		</div>
		    		
		    		<div class="btn-group">
		    			<div id="directline" class="btn btn-default btn-sm active" title="直线"><div class="q-icon toolbar-edge"></div></div>
		    			<div id="cureline" class="btn btn-default btn-sm" title="曲线"><div class="q-icon toolbar-edge_VH"></div></div>
		    			<div id="showlabel" flag="false" class="btn btn-default btn-sm" title="标签"><div class="q-icon toolbar-json"></div></div>
		    		</div>
		    		
		    		<div class="btn-group">
		    			<div class="input-group"><input id="nodelabel" type="text" value=""/></div>
		    			<div id="findBtn" class="btn btn-default btn-sm" title="搜索"><div class="q-icon toolbar-search"></div></div>
		    		</div>
		    	</div>
		    	<div id="graph-panel-wrapper" style="width: 100%;height: 100%;"><canvas id="graph-panel"></canvas></div>
		    </div>
		</div>
</body>
    <script type="text/javascript" src="../js/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="../js/colpick/colpick.js"></script>
    <script type="text/javascript" src="jtopo-0.4.8-min.js"></script>
    <script type="text/javascript" src="../data/data.js"></script> 
    <script type="text/javascript" src="../algorims/fr/frLayout.js"></script>
    <script type="text/javascript" src="../algorims/circle/circleLayout.js"></script>
    <script type="text/javascript" src="../algorims/arf/arfLayout.js"></script>
    <script type="text/javascript" src="../algorims/grid/gridLayout.js"></script>
    <script type="text/javascript" src="../algorims/kk/kkLayout.js"></script>
    <script type="text/javascript" src="../algorims/circle/dualLayout.js"></script>
    <script type="text/javascript" src="../algorims/circle/layerLayout.js"></script>
    <script type="text/javascript" src="../algorims/tree/treeLayout.js"></script>
    <script type="text/javascript" src="../algorims/tree/radiatreeLayout.js"></script>
    <script type="text/javascript" src="../algorims/tree/balloonLayout.js"></script>
    <script type="text/javascript" src="../algorims/tree/balloontreeLayout.js"></script>
    <script type="text/javascript" src="../algorims/fruchterman/fruchtermanLayout.js"></script>
    <script type="text/javascript" src="../algorims/spring/springLayout.js"></script>
    <script type="text/javascript" src="../algorims/spring/springLayout2.js"></script>
    
    <script type="text/javascript" src="graphClient.js"></script>
     
    <script type="text/javascript">
	    
	   var graphClient = null;
	   $(function(){
	   		autoResize();

	    	var canvas = document.getElementById("graph-panel");
	    	
	    	graphClient = new GraphClient(canvas);
	    	graphClient.drawData(data2);	    	
	    	
	    	$("#nodecount").text(graphClient.nodes.length);
	    	$("#linkcount").text(graphClient.links.length);

            var templWrapper = $('#neighber-nodes').empty();
            var nodeHtml = '';
	    	graphClient.nodes.forEach(function(_node){
        		nodeHtml += ('<dl class="node-label">'+_node.label+'</dl>');
	    	});
	    	templWrapper.append(nodeHtml);
	    	
	    	
	    	$("#runbtn").click(function(){
	    		var layouttype = $("#layout-type").val();
	    		if($(this).text() == '运行'){
	    			$(this).text("停止").css('color','red');
	    			
	    			if(graphClient != null){
	    				graphClient.runLayout(layouttype);
	    			}
	    			
	    		}else{
	    			$(this).text("运行").css('color','#FFFFFF');
	    			
	    			if(graphClient != null){
	    				graphClient.stopLayout();
	    			}
	    		}
	    	});
	    	
	    	$("#mousetype .btn").click(function(){
	    		$(this).addClass("active");
	    		$(this).siblings().removeClass("active");
	    		var type = $(this).attr("type");
	    		graphClient.setMouseModel(type);
	    	});
	    	$("#zoomtype .btn").click(function(){
	    		var type = $(this).attr("type");
	    		graphClient.setZoom(type);
	    	});
	    	$("#directline").click(function(){
	    		graphClient.setLineType(1);
	    		$(this).addClass("active");
	    		$("#cureline").removeClass("active");
	    	});
	    	$("#cureline").click(function(){
	    		graphClient.setLineType(2);
	    		$(this).addClass("active");
	    		$("#directline").removeClass("active");
	    	});
	    	$("#showlabel").click(function(){
	    		var flag = $(this).attr("flag")
	    		if(flag == 'true'){
	    		    $(this).attr("flag","false");
	    		    $(this).removeClass("active");
	    		    graphClient.showNodeLabel(false);
	    		}else{
	    			$(this).attr("flag","true");
	    			$(this).addClass("active");
	    			graphClient.showNodeLabel(true);
	    		}
	    	});
	    	$("#savepic").click(function(){
	    		graphClient.saveImage();
	    	});
	    	$("#overview").click(function(){
	    		var flag = $(this).attr("flag")
	    		if(flag == 'true'){
	    		    $(this).attr("flag","false");
	    		    $(this).removeClass("active");
	    		    graphClient.showOverView(false);
	    		}else{
	    			$(this).attr("flag","true");
	    			$(this).addClass("active");
	    			graphClient.showOverView(true);
	    		}
	    	});
	    	$("#findBtn").click(function(){
	    		var text = $("#nodelabel").val().trim();
	    		if(text.length > 0){
	    			graphClient.findNode(text);
	    		}
	    	});
	    	
	    	$("#nodesize").on("change",function(){
	    		var size = $(this).val();
	    		graphClient.setNodeSize(size);
	    	});

	    	$("#nodealpha").on("change",function(){
	    		var alpha = $(this).val();
	    		graphClient.setNodeAlpha(alpha);
	    	});

	    	$("#neighber-nodes").delegate('.node-label','click',function(){
	    		var text = $(this).text();
	    		graphClient.findNode(text);
	    	});
	    	
	    	//节点的颜色选择器
	    	$('#nodeColor').colpick({
				//colorScheme:'dark',
				layout:'rgbhex',
				color:'d91bf0',
				onSubmit:function(hsb,hex,rgb,el) {
					$(el).css('background-color', '#'+hex);
					$(el).colpickHide();
					graphClient.setNodeColor(rgb.r,rgb.g,rgb.b);
				}
			})
			.css('background-color', 'rgb(195,30,235)');
			
			$('#linkColor').colpick({
				//colorScheme:'dark',
				layout:'rgbhex',
				color:'fafafa',
				onSubmit:function(hsb,hex,rgb,el) {
					$(el).css('background-color', '#'+hex);
					$(el).colpickHide();
					graphClient.setLinkColor(rgb.r,rgb.g,rgb.b);
				}
			})
			.css('background-color', 'rgb(250,255,250)');
			
	    });
	    window.onresize = autoResize;
	
	    /**自动设置界面布局大小自适应**/
	    function autoResize(){
	    	var currWinWidth = window.innerWidth,currWinHeight = window.innerHeight -2;
	    	$(".center").css({height:currWinHeight+"px"});
	    	
	    	var width = $(".center").width(),height=$(".center").height()-30;
	    	$("#graph-panel").attr({width:width,height:height});
	    }
	    
    </script>
</html>